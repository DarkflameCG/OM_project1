<%@ page contentType="text/html;charset=UTF-8" language="java" %>
<html>
<head>
    <title>Title</title>
</head>
<script>
    function createCORSRequest(method, url) {
        var xhr = new XMLHttpRequest();
        if ("withCredentials" in xhr) {
            xhr.open(method, url, true);
        } else if (typeof XDmainRequest != "undefined") { //兼容IE
            xhr = new XDmainRequest();
            xhr.open(method, url, true);
        } else {
            xhr = null;
        }
        return xhr;
    }
 
    function upload() {
        // 表单数据对象
        var formData = new FormData();
        // 多个文件需要进行逐个遍历
        for (var i = 0; i < document.getElementById("files").files.length; i++) {
            // 将文件数据添加到表单数据中
            formData.append("files", document.getElementById("files").files[i]);
        }
        var request = createCORSRequest('post', 'upload');
        if (request) {
            request.onload = function () {
                if (request.responseText == "1") {
                    alert("上传成功！");
                } else {
                    alert("上传失败！");
                }
            };
            // 给进度条添加监听事件，这样才有进度条的效果
            request.upload.addEventListener("progress", progressChange, false)
 
            // 上传表单数据
            request.send(formData);
        }
    }
 
    // 改变进度条
    function progressChange(event) {
        progress1.max = event.total;  // 数据的总大小
        progress1.value = event.loaded;  // 当前已上传的大小
    }
 
</script>
<body>
    <input type="file" id="files" name="fileUpload" multiple="multiple"/>
    <button type="button" name="button" onclick="upload()">上传</button>
    <br><br>
    <progress id="progress1"></progress>
</body>
</html>
