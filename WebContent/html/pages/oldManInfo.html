<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>ç”¨æˆ·åˆ—è¡¨</title>
    <!-- jQuery (Bootstrap çš„æ‰€æœ‰ JavaScript æ’ä»¶éƒ½ä¾èµ– jQueryï¼Œæ‰€ä»¥å¿…é¡»æ”¾åœ¨å‰è¾¹) -->
    <script src="https://cdn.bootcss.com/jquery/1.12.4/jquery.min.js"></script>
    <!-- æœ€æ–°ç‰ˆæœ¬çš„ Bootstrap æ ¸å¿ƒ CSS æ–‡ä»¶ -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/css/bootstrap.min.css"
        integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    <!-- æœ€æ–°çš„ Bootstrap æ ¸å¿ƒ JavaScript æ–‡ä»¶ -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/js/bootstrap.min.js"
        integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa"
        crossorigin="anonymous"></script>
    <!--validateéªŒè¯è¡¨å•æ’ä»¶-->
    <script src="http://static.runoob.com/assets/jquery-validation-1.14.0/dist/jquery.validate.min.js"></script>
    <script src="http://static.runoob.com/assets/jquery-validation-1.14.0/dist/localization/messages_zh.js"></script>
    <script src="js/lTable.js" type="text/javascript"></script>
</head>
<script>
    //å®šä¹‰ä¸€ä¸ªå˜é‡ç”¨äºå­˜å‚¨æ·»åŠ å’Œä¿®æ”¹æ—¶ä¸åŒçš„URL
    var myUrl;
    //ä¼ å…¥ç‚¹å‡»çš„ç”¨æˆ·idï¼Œè·å–è¯¥ç”¨æˆ·ä¿¡æ¯å¹¶æ”¾å…¥è¡¨å•ä¸­
    function update(id) {
        //å°†æäº¤è¡¨å•çš„URLå˜ä¸ºupdate
        myUrl = '/updateUser';
        if (!id) {
            alert('idé”™è¯¯');
            return false;
        }

        $.ajax(
            {
                url: "/toUpdateUser",
                data: { "id": id },
                type: "post",
                //è§£å†³ç¼–ç é—®é¢˜
                scriptCharset: 'utf-8',
                beforeSend: function () {
                    return true;
                },
                success: function (data) {
                    if (data) {
                        //è§£æjsonæ•°æ®
                        var data = data;
                        var user = eval("(" + data + ")");
                        //èµ‹å€¼
                        $('#userID').val(user.userID);
                        $('#username').val(user.username);
                        $('#password').val(user.password);
                        $('#phone').val(user.phone);
                        $('#email').val(user.email);
                        //åœ¨ä¿®æ”¹ç”¨æˆ·ä¿¡æ¯æ—¶ï¼Œusernameä¸å¯ä¿®æ”¹
                        $('#username').attr("readonly", "readonly");
                    }
                }
            });
    }

    //è¡¨å•å­—æ®µéªŒè¯
    //å¦‚æœæŒ‰ç…§ä¸€èˆ¬éªŒè¯çš„å†™æ³•ï¼Œåªèƒ½è°ƒç”¨æ•´ä¸ªè¡¨å•çš„validateå‡½æ•°ï¼Œè€Œä¸èƒ½è°ƒç”¨è‡ªå®šä¹‰çš„usernameéªŒè¯ï¼Œæ‰€ä»¥æŠŠä¸¤ä¸ªå‡½æ•°å°è£…æˆä¸ºä¸€ä¸ªï¼Œåœ¨ç‚¹å‡»æŒ‰é’®æ—¶è°ƒç”¨
    function vali() {
        //form-dataè¡¨å•éªŒè¯ã€‚
        $("#form-data").validate({
            onfocusout: function (element) { $(element).valid(); },
            onblur: function (element) { $(element).valid(); },    //é¼ æ ‡ç§»å¼€éªŒè¯ã€‚è¿™é‡Œå†™onblue:trueæ²¡æœ‰æ•ˆæœ
            onsubmit: true,      //æäº¤æ—¶éªŒè¯ï¼ˆæœ‰æ•ˆï¼‰
            onkeyup: false,

            rules: {
                password: {
                    required: true,
                    rangelength: [5, 20]
                },
                phone: {
                    required: true,
                    digits: true,
                    rangelength: [11, 11]
                },
                email: {
                    required: true,
                    email: true
                }
            },
            messages: {
                password: {
                    required: "è¯·å¡«å†™å¯†ç ",
                    rangelength: "å¯†ç é•¿åº¦ä¸ç¬¦åˆè§„èŒƒ"
                },
                phone: {
                    required: "è¯·å¡«å†™æ‰‹æœºå·",
                    digits: "è¯·å¡«å†™æ­£ç¡®çš„æ‰‹æœºå·",
                    rangelength: "è¯·å¡«å†™æ­£ç¡®çš„æ‰‹æœºå·"
                },
                email: {
                    required: "è¯·å¡«å†™é‚®ç®±",
                    email: "è¯·å¡«å†™æ­£ç¡®çš„é‚®ç®±"
                }
            },
            submitHandler: function (form) {
                checkForm();
            }
        });
        //è‡ªå®šä¹‰åŠ¨æ€usernameéªŒè¯
        //usernameçš„æ ¡éªŒåªåœ¨æ·»åŠ æ“ä½œæ—¶æ‰éœ€è¦
        //é€šè¿‡å¯¹usernameçš„readonlyå±æ€§éªŒè¯æ¥åˆ¤æ–­æ˜¯æ·»åŠ è¿˜æ˜¯æ›´æ–°
        if ($('#username').attr("readonly") == undefined) {
            $('#username').rules("add", {
                required: true,
                rangelength: [5, 20],
                remote: {
                    type: "POST",
                    url: "/checkUsername",
                    data: {
                        username: function () {
                            return $("#username").val();
                        }
                    },
                    dataType: "html",
                    dataFilter: function (data) {
                        if (data == "true")
                            return true;
                        else
                            return false;
                    }
                },
                messages: {
                    required: "è¯·å¡«å†™ç”¨æˆ·å",
                    remote: "ç”¨æˆ·åå·²å­˜åœ¨",
                    rangelength: "ç”¨æˆ·åé•¿åº¦ä¸ç¬¦åˆè§„èŒƒ"
                }
            });
        }
    }
    /*
    ç‚¹å‡»æ·»åŠ ç”¨æˆ·æ—¶éœ€è¦åšçš„æ“ä½œï¼š
        1.ä¿®æ”¹æäº¤è¡¨å•çš„URL
        2.å°†usernameçš„readonlyå±æ€§ç§»é™¤
        3.æ¸…ç©ºè¡¨å•æ•°æ®
     */
    function setUrl() {
        myUrl = '/addUser';
        $('#username').removeAttr("readonly");
        // $('#form-data input').val(" ");// æ¸…é™¤æ¨¡æ€æ¡†ä¸­çš„å€¼
    }


    //æäº¤è¡¨å•
    function checkForm() {

        var formData;
        //å°†è¡¨å•å†…å®¹åºåˆ—åŒ–ï¼Œå³å¯å¾—åˆ°ç›¸åº”å¯¹è±¡ï¼Œç›´æ¥ä¼ åˆ°åå°
        //useridä¸ºç©ºæ—¶ï¼Œå³å½“å‰æ“ä½œä¸ºæ·»åŠ ç”¨æˆ·æ“ä½œï¼Œæ­¤æ—¶åªåºåˆ—åŒ–é™¤idä¹‹å¤–å››ä¸ªå±æ€§ï¼Œæ·»åŠ ç”¨æˆ·æ—¶idè‡ªå¢é•¿ã€‚å¦‚æœidä¸ºç©ºä¹Ÿè¢«åºåˆ—åŒ–ä¼šæŠ¥é”™
        if ($('#userID').val() == null || $('#userID').val() == undefined || $('#userID').val().length == 0) {
            formData = $('#username,#password,#email,#phone').serializeArray();
        }
        //å¦åˆ™ä¸ºæ›´æ–°æ“ä½œï¼Œuseridä¸ºéšè—inputï¼Œå¹¶ä¸”å·²ç»è¢«èµ‹å€¼ï¼Œåºåˆ—åŒ–æ•´ä¸ªè¡¨å•å³å¯
        else {
            formData = $('#form-data').serializeArray();
        }

        $.ajax({
            url: myUrl,      //æ ¹æ®æ“ä½œä¼ å…¥ä¸åŒçš„URL
            data: formData,  //ä¼ å…¥åºåˆ—åŒ–çš„è¡¨å•å¯¹è±¡
            type: "post",
            datatype: 'text',
            async: false,    //å¼‚æ­¥ä¼ è¾“
            timeout: 50000,
            //è®¾ç½®ç¼–ç 
            contentType: "application/x-www-form-urlencoded; charset=utf-8",
            beforeSend: function () {
                $('#tip').html('<span style="color: cornflowerblue">æ­£åœ¨å¤„ç†...</span>');
                return true;
            },
            success: function (data) {
                if (data > 0) {
                    $('#tip').html('<span style="color: green">æ“ä½œæˆåŠŸï¼</span>');
                    location.reload();
                } else {
                    $('#tip').html('<span style="color: red">æ“ä½œå¤±è´¥ï¼Œè¯·é‡è¯•</span>');
                }
            },
            error: function (XMLHttpRequest, textStatus, errorThrown) {
                // alert(XMLHttpRequest.status);//çŠ¶æ€ç 
                // alert(XMLHttpRequest.readyState);//çŠ¶æ€
                // alert(textStatus);//é”™è¯¯ä¿¡æ¯
                alert("å‡ºé”™äº†");
            },
            complete: function () {

            }
        });
    }


    function deletebyId(id) {
        alert(id)
        if (!id) {
            alert('idé”™è¯¯');
            return false;
        }

        $.ajax(
            {
            });
    }

    function deleteUser(id) {
        alert(id)
        //åŠ è½½æ¨¡æ€æ¡†
        $('#deleteModal').modal();
    }
</script>

<body>
    <div class="container-fluid">
        <div class="tool">
            <div class="row">
                <br />
                <form action="" class="form-horizontal">

                    <div class="col-sm-3">
                        <input type="text" id="search" class="form-control">
                    </div>
                    <div class="col-sm-1">
                        <button type="submit" class="btn btn-primary">æœç´¢</button>
                    </div>
                </form>
                <div class="col-sm-4">

                </div>
                <div class="col-sm-2">
                    <button type="button" class="btn btn-warning" data-toggle="modal" data-target="#updateModal"
                        onclick="setUrl()">æ·»åŠ  ğŸ‘´</button>
                    <button type="button" class="btn btn-danger"
                        th:onclick="'javascript:deleteUser('+${user.userID}+')' ">æ‰¹é‡åˆ é™¤</button>
                </div>
            </div>
        </div>
        <br>
        <table class="table table-bordered table-hover">
            <thead>
                <tr>
                    <th>id</th>
                    <th>å§“å</th>
                    <th>ç…§ç‰‡</th>
                    <th>å¹´é¾„</th>
                    <th>å…¥ä½æ—¶é—´</th>
                    <th>å¥åº·çŠ¶å†µ</th>
                    <th>è€äººå®¶å±</th>
                    <th>ç”µè¯</th>
                    <th>æˆ¿é—´å·</th>
                    <th>æŠ¤å·¥å§“å</th>
                    <th>æ“ä½œ</th>
                </tr>
            </thead>
            <tbody>
                <tr th:each="user : ${userlist}">
                    <td th:text="${user.userID}"></td>
                    <td th:text="${user.username}"></td>
                    <td th:text="${user.password}"></td>
                    <td th:text="${user.phone}"></td>
                    <td th:text="${user.email}"></td>
                    <td th:text="${user.email}"></td>
                    <td th:text="${user.email}"></td>
                    <td th:text="${user.email}"></td>
                    <td th:text="${user.email}"></td>
                    <td th:text="${user.email}"></td>
                    <td>
                        <!--ä¼ å…¥å½“å‰ç”¨æˆ·id-->
                        <button type="button" class="btn btn-info btn-sm" data-toggle="modal" data-target="#updateModal"
                            th:onclick="'javascript: update('+${user.userID}+')' ">ç¼–è¾‘</button>
                        <button type="button" class="btn btn-danger btn-sm" data-toggle="modal"
                            data-target="#deleteModal"
                            th:onclick="'javascript:deleteUser('+${user.userID}+')' ">åˆ é™¤</button>
                    </td>
                </tr>
            </tbody>
        </table>
        <!-- åˆ†é¡µå¼€å§‹ -->
        <table width="461" height="24" border="1" cellpadding="0" cellspacing="0">
            <tr>
                <td width="199">å½“å‰ä¸ºç¬¬${page.currentPage}é¡µ,å…±${page.totalPage}é¡µ</td>
                <td width="256">
                    <c:choose>
                        <c:when test="${page.hasPrePage}">
                            <a href="<%=path %>/user.do?method=list&currentPage=1">é¦–é¡µ</a> |
                            <a href="<%=path %>/user.do?method=list&currentPage=${page.currentPage -1 }">ä¸Šä¸€é¡µ</a>
                        </c:when>
                        <c:otherwise>
                        </c:otherwise>
                    </c:choose>
                    <c:choose>
                        <c:when test="${page.hasNextPage}">
                            <a href="<%=path %>/user.do?method=list&currentPage=${page.currentPage + 1 }">ä¸‹ä¸€é¡µ</a> |
                            <a href="<%=path %>/user.do?method=list&currentPage=${page.totalPage }">å°¾é¡µ</a>
                        </c:when>
                        <c:otherwise>
                        </c:otherwise>
                    </c:choose>
                </td>
            </tr>
        </table>
        <!-- åˆ†é¡µç»“æŸ -->
        <!--æ¨¡æ€æ¡†-->
        <form method="post" name="user" class="form-horizontal" role="form" id="form-data" style="margin: 20px;">
            <div class="modal fade" id="updateModal" tabindex="-1" role="dialog" aria-labelledby="updateModalLabel"
                aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
                                &times;
                            </button>
                            <h4 class="modal-title" id="updateModalLabel">
                                ç”¨æˆ·ä¿¡æ¯
                            </h4>
                        </div>
                        <div class="modal-body">
                            <form action="" class="form-horizontal">
                                <!--useridä¸ºéšè—çš„inputï¼Œä¾¿äºupdateæ—¶çš„ä¼ å€¼-->
                                <input type="text" id="userID" name="userID" hidden>
                                <div class="form-group">
                                    <label for="oldman_name" class="col-sm-3 control-label">å§“å</label>
                                    <div class="col-sm-9">
                                        <input type="text" class="form-control" id="oldman_name" name="oldman_name"
                                            placeholder="å§“åé•¿åº¦åœ¨2-10å­—ç¬¦ä¹‹é—´">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="age" class="col-sm-3 control-label">å¹´é¾„</label>
                                    <div class="col-sm-9">
                                        <input type="text" class="form-control" id="age" name="age"
                                            placeholder="è¯·è¾“å…¥å¹´é¾„">
                                    </div>
                                </div>
                                <!-- <div class="form-group">
                                    <label for="username" class="col-sm-3 control-label">å…¥ä½æ—¶é—´</label>
                                    <div class="col-sm-9">
                                        <input type="text" class="form-control" id="username" name="username"
                                            placeholder="ç”¨æˆ·åé•¿åº¦åœ¨5-18å­—ç¬¦ä¹‹é—´">
                                    </div>
                                </div> -->
                                <div class="form-group">
                                    <label for="username" class="col-sm-3 control-label">å¥åº·çŠ¶å†µ</label>
                                    <div class="col-sm-9">
                                        <input type="text" class="form-control" id="username" name="username"
                                            placeholder="è¯·è¾“å…¥è€äººçš„å¥åº·çŠ¶å†µ">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="password" class="col-sm-3 control-label">è€äººå®¶å±</label>
                                    <div class="col-sm-9">
                                        <input type="text" class="form-control" id="password" name="password"
                                            placeholder="è¯·è¾“å…¥è€äººå®¶å±å§“å">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="telphone" class="col-sm-3 control-label">æ‰‹æœºå·</label>
                                    <div class="col-sm-9">
                                        <input type="text" class="form-control" id="telphone" name="telphone"
                                            placeholder="è¯·è¾“å…¥æ‰‹æœºå·">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="email" class="col-sm-3 control-label">æˆ¿é—´å·</label>
                                    <div class="col-sm-9">
                                        <input type="email" class="form-control" id="email" name="email"
                                            placeholder="è¯·è¾“å…¥æˆ¿é—´å·">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="email" class="col-sm-3 control-label">æŠ¤å·¥å§“å</label>
                                    <div class="col-sm-9">
                                        <input type="email" class="form-control" id="email" name="email"
                                            placeholder="è¯·è¾“å…¥æŠ¤å·¥å§“å">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="username" class="col-sm-3 control-label">ç…§ç‰‡</label>
                                    <div class="col-sm-9">
                                        <label for="file">
                                            <div class="panel updatepanel">
                                                <div class="addbox"><span class="icon-add-50">+ç‚¹å‡»ä¸Šä¼ </span></div>
                                                <input type="file" id="oldman_img" style="display: none" />
                                            </div>
                                        </label>
                                    </div>
                                </div>
                            </form>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-default" data-dismiss="modal">å…³é—­</button>
                            <!--typeä¸ºsubmitæ—¶ï¼Œä¼šè‡ªåŠ¨è°ƒç”¨è¯¥è¡¨å•çš„éªŒè¯ï¼Œä½†æ˜¯ä¸ä¼šè°ƒç”¨è‡ªå·±å®šä¹‰çš„åŠ¨æ€çš„usernameçš„éªŒè¯ï¼Œ
                    æ‰€ä»¥æŠŠæŒ‰é’®ç±»å‹æ”¹ä¸ºinputï¼Œå†æ‰‹åŠ¨è°ƒç”¨å°è£…å¥½çš„éªŒè¯å‡½æ•°-->
                            <button type="input" class="btn btn-primary" onclick="vali();">æäº¤</button>
                            <span id="tip"></span>
                        </div>
                    </div>
                </div>
            </div>
        </form>
        <!-- æ¨¡æ€æ¡†ç»“æŸ -->
        <!--åˆ é™¤æ¨¡æ€æ¡†-->
        <form method="post" name="user" class="form-horizontal" role="form" id="form-data" style="margin: 20px;">
            <div class="modal fade bs-example-modal-sm" id="deleteModal" tabindex="-1" role="dialog"
                aria-labelledby="mySmallModalLabel">
                <div class="modal-dialog modal-sm" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
                                &times;
                            </button>
                            <h4 class="modal-title" id="">
                                è­¦å‘Šï¼šç¡®è®¤åˆ é™¤ï¼Ÿ
                            </h4>
                        </div>
                        <div class="modal-footer">
                            <button type="input" class="btn btn-danger" onclick="deletebyId(id);">ç¡®å®š</button>
                            <button type="button" class="btn btn-default" data-dismiss="modal">å–æ¶ˆ</button>
                            <!--typeä¸ºsubmitæ—¶ï¼Œä¼šè‡ªåŠ¨è°ƒç”¨è¯¥è¡¨å•çš„éªŒè¯ï¼Œä½†æ˜¯ä¸ä¼šè°ƒç”¨è‡ªå·±å®šä¹‰çš„åŠ¨æ€çš„usernameçš„éªŒè¯ï¼Œ
                      æ‰€ä»¥æŠŠæŒ‰é’®ç±»å‹æ”¹ä¸ºinputï¼Œå†æ‰‹åŠ¨è°ƒç”¨å°è£…å¥½çš„éªŒè¯å‡½æ•°-->
                            <span id="tip"></span>
                        </div>
                    </div>
                </div>
            </div>
        </form>
        <!-- æ¨¡æ€æ¡†ç»“æŸ -->
    </div>

    <!-- Small modal -->


    <div th:insert="template/footer :: copyright"></div>

    <script>

        $(".updatepanel").height($(".panel-info").height());
        document.getElementById('file').onchange = function () {
            add();
            var imgFile = this.files[0];
            var fr = new FileReader();
            fr.onload = function () {
                var imgs = document.getElementsByClassName('updateimg');
                imgs[imgs.length - 1].src = fr.result;
            };
            fr.readAsDataURL(imgFile);
        };
        function add() {
            var html = "<div class='col-sm-4'><div class='panel panel-info'><div class='panel-heading'><i class='fa fa-times'></i></div><div class='panel-body' style='text-align: center;'><div class='row'><div class='col-sm-12 col-md-12'><img class='updateimg img-responsive' src='img/p_big3.jpg' style='width: inherit;height: 210px;'/></div></div></div></div></div>";
            $("#updatebox").before(html);
        }
        $(".fa-times").click(function () {
            $(this).parent().parent().parent().remove();
        });

    </script>
</body>

</html>